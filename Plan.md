# Project Flower - Backend Renewal Plan

**Author:** Prometheus (Lead Planner)  
**Date:** 2026-01-21  
**Version:** 2.0.0 (Pragmatic Pivot)  
**Status:** **Approved** (Replaces v1.0.0)

---

## 1. í”„ë¡œì íŠ¸ ë¹„ì „ (Project Vision)

**"ë³µì¡í•¨ì€ ê±°ë¶€í•œë‹¤. ì‹¤ìš©ì„±ì„ ì¶”êµ¬í•˜ë˜, ëª¨ë“ˆì˜ ê²½ê³„ëŠ” ì‚¬ìˆ˜í•œë‹¤."**

**Flower-Back**ì€ 1ì¸ ê°œë°œ ë° AI í˜‘ì—… í™˜ê²½ì— ìµœì í™”ëœ **'ì‹¤ìš©ì  ëª¨ë“ˆëŸ¬ ëª¨ë†€ë¦¬ìŠ¤(Pragmatic Modular Monolith)'**ë¥¼ ì§€í–¥í•©ë‹ˆë‹¤.
ì˜¤ë²„ì—”ì§€ë‹ˆì–´ë§(í—¥ì‚¬ê³ ë‚  ì•„í‚¤í…ì²˜ì˜ ë¬´ì¡°ê±´ì  ë„ì…)ì„ ì§€ì–‘í•˜ê³ , ë¹ ë¥¸ ê°œë°œ ì†ë„ì™€ ìœ ì§€ë³´ìˆ˜ì„±ì˜ ê· í˜•ì„ ë§ì¶¥ë‹ˆë‹¤.

### 1.1 í•µì‹¬ ê°€ì¹˜ (Core Values)
1.  **Simplicity (ë‹¨ìˆœí•¨)**: ë¶ˆí•„ìš”í•œ ì¶”ìƒí™”(Interface, Port)ë¥¼ ì œê±°í•˜ì—¬ ì½”ë“œ ë³µì¡ë„ë¥¼ ë‚®ì¶¥ë‹ˆë‹¤.
2.  **Modularity (ëª¨ë“ˆí™”)**: ëª¨ë“ˆ ê°„ì˜ ë¬¼ë¦¬ì  ë¶„ë¦¬ëŠ” ìœ ì§€í•˜ë˜, ë‚´ë¶€ êµ¬ì¡°ëŠ” ìœ ì—°í•˜ê²Œ ê°€ì ¸ê°‘ë‹ˆë‹¤.
3.  **Velocity (ì†ë„)**: Boilerplate ì½”ë“œë¥¼ ìµœì†Œí™”í•˜ì—¬ AIì™€ ê°œë°œìì˜ ìƒì‚°ì„±ì„ ê·¹ëŒ€í™”í•©ë‹ˆë‹¤.

---

## 2. ì•„í‚¤í…ì²˜ ê²°ì • ì‚¬í•­ (Architecture Decision Record)

### 2.1 ì•„í‚¤í…ì²˜ ìŠ¤íƒ€ì¼ ë³€ê²½
- **AS-IS (v1.0.0 Plan)**: í—¥ì‚¬ê³ ë‚  ì•„í‚¤í…ì²˜ (Ports & Adapters)
    - ëª¨ë“  ê³„ì¸µì— ì¸í„°í˜ì´ìŠ¤ ê°•ì œ (`Port.in`, `Port.out`).
    - DTO ë§¤í•‘ ë¹„ìš© ê³¼ë‹¤ ë°œìƒ.
- **TO-BE (v2.0.0 Plan)**: **ì‹¤ìš©ì  ê³„ì¸µí˜• ì•„í‚¤í…ì²˜ (Pragmatic Layered Architecture)**
    - ëª¨ë“ˆ **ë‚´ë¶€**ëŠ” ì§ê´€ì ì¸ `Controller` -> `Service` -> `Repository` êµ¬ì¡° ì±„íƒ.
    - ë‹¨, ëª¨ë“ˆ **ê°„** í†µì‹ ì€ ì² ì €íˆ ê²©ë¦¬ (Public Service ë˜ëŠ” Event ì‚¬ìš©).

### 2.2 íŒ¨í‚¤ì§€ êµ¬ì¡° ê°€ì´ë“œë¼ì¸
ëª¨ë“ˆ ë‚´ë¶€ì—ì„œ `port`, `adapter` íŒ¨í‚¤ì§€ë¥¼ ì œê±°í•˜ê³ , ì—­í• ë³„ íŒ¨í‚¤ì§€ë¡œ ë‹¨ìˆœí™”í•©ë‹ˆë‹¤.

**ê¶Œì¥ êµ¬ì¡° (`order` ëª¨ë“ˆ ì˜ˆì‹œ):**
```text
com.flower.order
â”œâ”€â”€ controller      # (Optional) ëª¨ë“ˆ ìì²´ ì»¨íŠ¸ë¡¤ëŸ¬ê°€ í•„ìš”í•  ê²½ìš°
â”œâ”€â”€ service         # ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ (Public Class)
â”œâ”€â”€ repository      # ë°ì´í„° ì ‘ê·¼ (Package-Private)
â”œâ”€â”€ domain          # JPA Entity & Domain Logic
â”œâ”€â”€ dto             # ë°ì´í„° ì „ì†¡ ê°ì²´ (Record)
â””â”€â”€ event           # ë„ë©”ì¸ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ/ë°œí–‰
```

### 2.3 í†µì‹  ì›ì¹™
1.  **ëª¨ë“ˆ ë‚´ë¶€**: `Service`ê°€ `Repository`ë¥¼ ì§ì ‘ í˜¸ì¶œ.
2.  **ëª¨ë“ˆ ì™¸ë¶€ (`api` -> `order`)**: `api` ëª¨ë“ˆì˜ ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” `order` ëª¨ë“ˆì˜ **Public Service**ë§Œ í˜¸ì¶œ ê°€ëŠ¥.
    - âŒ `api`ê°€ `order`ì˜ `Repository`ì— ì ‘ê·¼ ë¶ˆê°€ (Package-Private ê¶Œì¥).
    - âŒ `api`ê°€ `order`ì˜ `Entity`ë¥¼ ì§ì ‘ ë°˜í™˜ ë¶ˆê°€ (ë°˜ë“œì‹œ DTO ë°˜í™˜).
3.  **ëª¨ë“ˆ ê°„ (`order` <-> `inventory`)**: **Spring Event**ë¥¼ í†µí•œ ë¹„ë™ê¸° í†µì‹  ìœ ì§€.

---

## 3. ë„ë©”ì¸ ë¡œë“œë§µ (Domain Roadmap)

íŒŒì¼ëŸ¿ ë¦¬íŒ©í† ë§ ì—†ì´, ì‹¤ìš©ì  êµ¬ì¡°ë¡œ ê¸°ëŠ¥ì„ ë¹ ë¥´ê²Œ ì™„ì„±í•˜ëŠ” ê²ƒì— ì§‘ì¤‘í•©ë‹ˆë‹¤.

| ìš°ì„ ìˆœìœ„ | ë„ë©”ì¸ | ìƒíƒœ | ëª©í‘œ ë° ì‘ì—… ë‚´ìš© |
|:---:|:---|:---:|:---|
| **P1** | **Order** | âš ï¸ ë¦¬íŒ©í† ë§ | `adapter`, `port` íŒ¨í‚¤ì§€ ì œê±°. `Service` ì¤‘ì‹¬ êµ¬ì¡°ë¡œ ë‹¨ìˆœí™”. |
| **P1** | **Cart** | âš ï¸ ë¦¬íŒ©í† ë§ | ê³¼ë„í•œ í—¥ì‚¬ê³ ë‚  êµ¬ì¡° ì œê±°. `CartService` êµ¬í˜„ ë‹¨ìˆœí™”. |
| **P2** | **Payment** | ğŸ“ ì‹ ê·œ êµ¬í˜„ | PG ì—°ë™ (Toss/Kakao) êµ¬í˜„. ì™¸ë¶€ ì—°ë™ì´ë¯€ë¡œ ì—¬ê¸°ëŠ” **ì¸í„°í˜ì´ìŠ¤(Adapter)** íŒ¨í„´ ìœ ìš©í•¨. |
| **P2** | **Delivery** | ğŸ›  ë³´ì™„ | ë°°ì†¡ ìƒíƒœ ì¶”ì  ë¡œì§ ì¶”ê°€. |
| **P3** | **Member** | âœ… ìœ ì§€ | í˜„ì¬ êµ¬ì¡° ìœ ì§€í•˜ë˜, OAuth2 ë“± ì¸ì¦ ê³ ë„í™”. |

---

## 4. ìƒì„¸ êµ¬í˜„ ì§€ì¹¨ (Implementation Guidelines)

### 4.1 DTO ì „ëµ (Java Records)
- **Request/Response**: `Java Record` ì‚¬ìš©.
- **Mapping**: ë³„ë„ Mapper í´ë˜ìŠ¤ ì—†ì´ DTO ë‚´ë¶€ì˜ `static factory method` ë˜ëŠ” `constructor` í™œìš©.
  ```java
  // Good Example
  public record OrderDto(Long id, String status) {
      public static OrderDto from(Order order) {
          return new OrderDto(order.getId(), order.getStatus().name());
      }
  }
  ```

### 4.2 ì˜ì†ì„± (Persistence)
- **JPA**: ë³µì¡í•œ ì¿¼ë¦¬ëŠ” `QueryDSL` ë„ì… ê³ ë ¤ (í˜„ì¬ëŠ” JPQL/Method Nameìœ¼ë¡œ ì¶©ë¶„).
- **Transaction**: `Service` ë©”ì„œë“œ ë‹¨ìœ„ë¡œ `@Transactional` ì ìš©.

### 4.3 ì—ëŸ¬ ì²˜ë¦¬
- `BusinessException`ì„ ìƒì†ë°›ì€ êµ¬ì²´ì ì¸ ì˜ˆì™¸(`OrderNotFoundException` ë“±) ì‚¬ìš©.
- `api` ëª¨ë“ˆì˜ `GlobalExceptionHandler`ì—ì„œ ì¼ê´„ ì²˜ë¦¬.

---

## 5. Next Actions for Sisyphus (Developer)

1.  **Cart ëª¨ë“ˆ ë‹¤ì´ì–´íŠ¸**: `adapter`, `port` íŒ¨í‚¤ì§€ë¥¼ ì‚­ì œí•˜ê³  `service`, `repository`ë¡œ í”Œë«í•˜ê²Œ ë§Œë“œì‹­ì‹œì˜¤.
2.  **Order ëª¨ë“ˆ ë‹¨ìˆœí™”**: ë³µì¡í•œ íŒ¨í‚¤ì§€ êµ¬ì¡°ë¥¼ ì •ë¦¬í•˜ê³  ê¸°ëŠ¥ êµ¬í˜„ì— ì§‘ì¤‘í•˜ì‹­ì‹œì˜¤.
3.  **Payment êµ¬í˜„**: ì‹¤ì œ ê²°ì œ ìŠ¹ì¸ ë¡œì§ì„ `Port` ì¸í„°í˜ì´ìŠ¤ ë’¤ì— ìˆ¨ê¸°ëŠ” ì „ëµ(ì—¬ê¸°ë§Œ ì˜ˆì™¸ì ìœ¼ë¡œ ì–´ëŒ‘í„° íŒ¨í„´ ì‚¬ìš©)ì„ ì·¨í•˜ì‹­ì‹œì˜¤.

---
**"Simple is Best. ì½”ë“œëŠ” ì§ì´ ì•„ë‹ˆë¼ ìì‚°ì´ì–´ì•¼ í•œë‹¤."**
